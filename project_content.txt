================================================================================
–°–û–î–ï–†–ñ–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê: /home/slay/test_aio3
================================================================================


================================================================================
–§–ê–ô–õ: requirements.txt
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /home/slay/test_aio3/requirements.txt
–†–ê–ó–ú–ï–†: 1238 –±–∞–π—Ç
================================================================================

aiofiles==25.1.0
aiogram==3.24.0
aiohappyeyeballs==2.6.1
aiohttp==3.13.3
aiosignal==1.4.0
annotated-types==0.7.0
anyio==4.12.1
attrs==25.4.0
av==16.0.1
certifi==2026.1.4
charset-normalizer==3.4.4
click==8.3.1
coloredlogs==15.0.1
ctranslate2==4.6.3
environs==14.5.0
faster-whisper==1.2.1
filelock==3.20.2
flatbuffers==25.12.19
frozenlist==1.8.0
fsspec==2025.12.0
h11==0.16.0
hf-xet==1.2.0
httpcore==1.0.9
httpx==0.28.1
huggingface_hub==1.2.4
humanfriendly==10.0
idna==3.11
Jinja2==3.1.6
llvmlite==0.46.0
magic-filter==1.0.12
MarkupSafe==3.0.3
marshmallow==4.2.0
more-itertools==10.8.0
mpmath==1.3.0
multidict==6.7.0
networkx==3.6.1
numba==0.63.1
numpy==2.3.5
onnxruntime==1.23.2
openai-whisper==20250625
packaging==25.0
propcache==0.4.1
protobuf==6.33.2
pydantic==2.12.5
pydantic_core==2.41.5
python-dotenv==1.2.1
PyYAML==6.0.3
regex==2025.11.3
requests==2.32.5
setuptools==80.9.0
shellingham==1.5.4
sympy==1.13.1
tiktoken==0.12.0
tokenizers==0.22.2
torch @ https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp312-cp312-linux_x86_64.whl#sha256=4856f9d6925121d13c2df07aa7580b767f449dfe71ae5acde9c27535d5da4840
tqdm==4.67.1
triton==3.5.1
typer-slim==0.21.1
typing-inspection==0.4.2
typing_extensions==4.15.0
urllib3==2.6.2
yarl==1.22.0



================================================================================
–§–ê–ô–õ: run.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /home/slay/test_aio3/run.py
–†–ê–ó–ú–ï–†: 569 –±–∞–π—Ç
================================================================================

import asyncio
import logging
from aiogram import Dispatcher, Bot
from handlers import router
from config import Config, load_config
from fast_whisp_test import processor

config: Config = load_config('.env')

bot = Bot(token=config.bot.token)
dp = Dispatcher()


async def main():
    processor.load_model()
    dp.include_router(router)
    await dp.start_polling(bot)


if __name__ == '__main__':
    logging.basicConfig(level=logging.DEBUG) #, filemode='a', filename='lgg.log'
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print('Stop')


================================================================================
–§–ê–ô–õ: whisper_test.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /home/slay/test_aio3/whisper_test.py
–†–ê–ó–ú–ï–†: 200 –±–∞–π—Ç
================================================================================

import whisper


def speech_to_text(file_id):
    model = whisper.load_model("small")  
    result = model.transcribe(f"voices/{file_id}.ogg", language="ru", fp16=False)
    return result['text']







================================================================================
–§–ê–ô–õ: fast_whisp_test.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /home/slay/test_aio3/fast_whisp_test.py
–†–ê–ó–ú–ï–†: 2294 –±–∞–π—Ç
================================================================================

from faster_whisper import WhisperModel
import threading

# def faster_transcribe(file_id):
#     # compute_type="int8" ‚Äî –º–∞–≥–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Å–∂–∏–º–∞–µ—Ç –º–æ–¥–µ–ª—å, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–∞ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ CPU)
#     model_size = "large-v3"
#     model = WhisperModel(model_size, device="cpu", compute_type="int8", cpu_threads=2)

#     print("–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ù–∞—á–∏–Ω–∞—é —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É...")

#     # beam_size=5 ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Ö–æ—Ä–æ—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
#     segments, info = model.transcribe(f"voices/{file_id}.ogg",
#         beam_size=5,
#         language='ru'
#         )

#     chunks = []

#     # –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–¥–∞–µ—Ç—Å—è —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ (—á–∞—Å—Ç—è–º–∏)
#     for segment in segments:
#         print(f"[{segment.start:.2f}s -> {segment.end:.2f}s] {segment.text}")
#         chunks.append(segment.text)
    
#     return chunks



class WhisperProcessor:
    def __init__(self):
        self.model = None
        self._lock = threading.Lock()
    
    def load_model(self):
        with self._lock:
            if self.model is None:
                print("üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ Whisper...")
                self.model = WhisperModel(
    #                    "large-v3", 
                    'medium',
                    device="cpu", 
                    compute_type="int8", 
                    cpu_threads=3
                )
                print("‚úÖ –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞!")
        
    def transcribe(self, file_id):
        """–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —Å —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é"""
        if self.model is None:
            self.load_model()
        
        print(f"üîä –ù–∞—á–∏–Ω–∞—é —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É {file_id}...")
        
        segments, info = self.model.transcribe(
            f"voices/{file_id}.ogg",
            beam_size=5,
            language='ru',
            vad_filter=True
        )
        
        chunks = []
        for segment in segments:
            print(f"[{segment.start:.2f}s -> {segment.end:.2f}s] {segment.text}")
            chunks.append(segment.text)
        
        return chunks


# –°–æ–∑–¥–∞—ë–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
processor = WhisperProcessor()


================================================================================
–§–ê–ô–õ: scanner.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /home/slay/test_aio3/scanner.py
–†–ê–ó–ú–ï–†: 11197 –±–∞–π—Ç
================================================================================

import os
import re
import fnmatch
from pathlib import Path
from typing import Set, Optional, List
import sys

class ProjectScanner:
    def __init__(self, root_dir: str = ".", output_file: str = "project_content.txt"):
        self.root_dir = Path(root_dir).resolve()
        self.output_file = Path(output_file).resolve()
        self.gitignore_patterns = []
        self._load_gitignore()
        
    def _load_gitignore(self) -> None:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –ø–∞—Ä—Å–∏—Ç .gitignore —Ñ–∞–π–ª—ã"""
        gitignore_path = self.root_dir / ".gitignore"
        if gitignore_path.exists():
            with open(gitignore_path, 'r', encoding='utf-8', errors='ignore') as f:
                for line in f:
                    line = line.strip()
                    if line and not line.startswith('#'):
                        self.gitignore_patterns.append(line)
        
        # –í—Å–µ–≥–¥–∞ –∏—Å–∫–ª—é—á–∞–µ–º —Å–∞–º—É –ø–∞–ø–∫—É .git –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
        default_ignores = ['.git/', '__pycache__/', '*.pyc', '*.pyo', '*.pyd', '.env', 'venv/', '.venv/', 'env/']
        self.gitignore_patterns.extend(default_ignores)
        
        # –ò—Å–∫–ª—é—á–∞–µ–º –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        try:
            output_rel = self.output_file.relative_to(self.root_dir)
            self.gitignore_patterns.append(str(output_rel))
        except ValueError:
            # –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω–µ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
            pass
    
    def _is_ignored(self, path: Path) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ–ª–∂–µ–Ω –ª–∏ —Ñ–∞–π–ª/–ø–∞–ø–∫–∞ –±—ã—Ç—å –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω"""
        try:
            rel_path = path.relative_to(self.root_dir)
        except ValueError:
            # –§–∞–π–ª –≤–Ω–µ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            return True
            
        rel_str = str(rel_path).replace('\\', '/')
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —à–∞–±–ª–æ–Ω
        for pattern in self.gitignore_patterns:
            # –£–±–∏—Ä–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π / –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
            if pattern.startswith('/'):
                pattern = pattern[1:]
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ —à–∞–±–ª–æ–Ω—É
            if pattern.endswith('/'):
                # –ü–∞–ø–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –ø—É—Ç—å —Å —ç—Ç–æ–π –ø–∞–ø–∫–∏
                if rel_str.startswith(pattern) or f"{rel_str}/".startswith(pattern):
                    return True
            else:
                # –§–∞–π–ª: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∏–ª–∏ —à–∞–±–ª–æ–Ω fnmatch
                if rel_str == pattern or fnmatch.fnmatch(rel_str, pattern):
                    return True
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–ª—è –ª—é–±–æ–π —á–∞—Å—Ç–∏ –ø—É—Ç–∏
                if '/' in pattern and fnmatch.fnmatch(rel_str, f"*/{pattern}"):
                    return True
        
        return False
    
    def _is_binary_file(self, file_path: Path) -> bool:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª –±–∏–Ω–∞—Ä–Ω—ã–º"""
        # –°–ø–∏—Å–æ–∫ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
        binary_extensions = {'.pyc', '.pyo', '.pyd', '.so', '.dll', '.exe', '.bin', 
                            '.jpg', '.jpeg', '.png', '.gif', '.bmp', '.ico', 
                            '.pdf', '.doc', '.docx', '.xls', '.xlsx', '.zip', 
                            '.tar', '.gz', '.rar', '.7z', '.mp3', '.mp4', '.avi'}
        
        if file_path.suffix.lower() in binary_extensions:
            return True
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∞–π—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω—É–ª–µ–≤—ã—Ö –±–∞–π—Ç–æ–≤
        try:
            with open(file_path, 'rb') as f:
                chunk = f.read(1024)
                return b'\x00' in chunk
        except:
            return True
    
    def _get_file_content(self, file_path: Path) -> Optional[str]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –≤–∏–¥–µ"""
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–Ω–µ –±–æ–ª—å—à–µ 1MB)
            if file_path.stat().st_size > 1024 * 1024:
                return f"[–§–ê–ô–õ –°–õ–ò–®–ö–û–ú –í–ï–õ–ò–ö: {file_path.stat().st_size} –±–∞–π—Ç]"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±–∏–Ω–∞—Ä–Ω—ã–π –ª–∏ —Ñ–∞–π–ª
            if self._is_binary_file(file_path):
                return f"[–ë–ò–ù–ê–†–ù–´–ô –§–ê–ô–õ: {file_path.stat().st_size} –±–∞–π—Ç]"
            
            # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
            encodings = ['utf-8', 'cp1251', 'latin-1', 'iso-8859-1']
            
            for encoding in encodings:
                try:
                    with open(file_path, 'r', encoding=encoding) as f:
                        return f.read()
                except UnicodeDecodeError:
                    continue
                except Exception:
                    continue
            
            return f"[–ù–ï –£–î–ê–õ–û–°–¨ –ü–†–û–ß–ò–¢–ê–¢–¨ –§–ê–ô–õ: {file_path.stat().st_size} –±–∞–π—Ç]"
                    
        except Exception as e:
            return f"[–û–®–ò–ë–ö–ê –ß–¢–ï–ù–ò–Ø: {str(e)}]"
    
    def scan_project(self) -> None:
        """–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞"""
        total_files = 0
        skipped_files = 0
        ignored_files = 0
        
        print(f"–ù–∞—á–∏–Ω–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞: {self.root_dir}")
        print(f"–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª: {self.output_file}")
        print(f"–ü—Ä–∞–≤–∏–ª –∏–∑ .gitignore: {len(self.gitignore_patterns)}")
        
        with open(self.output_file, 'w', encoding='utf-8') as output:
            output.write("=" * 80 + "\n")
            output.write(f"–°–û–î–ï–†–ñ–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê: {self.root_dir}\n")
            output.write("=" * 80 + "\n\n")
            
            # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã
            for root, dirs, files in os.walk(self.root_dir):
                root_path = Path(root)
                
                # –£–¥–∞–ª—è–µ–º –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–ª—è –æ–±—Ö–æ–¥–∞
                dirs_to_remove = []
                for d in dirs:
                    dir_path = root_path / d
                    if self._is_ignored(dir_path):
                        dirs_to_remove.append(d)
                        ignored_files += 1
                
                for d in dirs_to_remove:
                    dirs.remove(d)
                
                for file in files:
                    file_path = root_path / file
                    
                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
                    if self._is_ignored(file_path):
                        ignored_files += 1
                        continue
                    
                    # –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
                    content = self._get_file_content(file_path)
                    if content is None:
                        skipped_files += 1
                        continue
                    
                    # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
                    try:
                        rel_path = file_path.relative_to(self.root_dir)
                    except ValueError:
                        rel_path = file_path
                    
                    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                    output.write("\n" + "=" * 80 + "\n")
                    output.write(f"–§–ê–ô–õ: {rel_path}\n")
                    output.write(f"–ü–û–õ–ù–´–ô –ü–£–¢–¨: {file_path}\n")
                    output.write(f"–†–ê–ó–ú–ï–†: {file_path.stat().st_size} –±–∞–π—Ç\n")
                    output.write("=" * 80 + "\n\n")
                    
                    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
                    output.write(content)
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
                    output.write("\n\n")
                    
                    total_files += 1
                    
                    # –í—ã–≤–æ–¥–∏–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                    if total_files % 10 == 0:
                        print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: {total_files}, –ø—Ä–æ–ø—É—â–µ–Ω–æ: {skipped_files}, –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ: {ignored_files}")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        print(f"\n{'='*60}")
        print(f"–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û")
        print(f"{'='*60}")
        print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: {total_files}")
        print(f"–ü—Ä–æ–ø—É—â–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ (–æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è): {skipped_files}")
        print(f"–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤ (–ø–æ .gitignore): {ignored_files}")
        print(f"–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ: {total_files + skipped_files + ignored_files}")
        print(f"–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª: {self.output_file}")
        
        if self.output_file.exists():
            print(f"–†–∞–∑–º–µ—Ä –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: {self.output_file.stat().st_size:,} –±–∞–π—Ç")


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    import argparse
    
    parser = argparse.ArgumentParser(
        description='–°–∫–∞–Ω–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç –∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog="""
–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
  %(prog)s                    # –°–∫–∞–Ω–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
  %(prog)s --dir /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É
  %(prog)s --output –ø—Ä–æ–µ–∫—Ç.txt
  %(prog)s --dir . --output ../–ø—Ä–æ–µ–∫—Ç_–∫–æ–ø–∏—è.txt
        """
    )
    
    parser.add_argument('--dir', '-d', default='.', 
                       help='–ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–∞—è)')
    parser.add_argument('--output', '-o', default='project_content.txt',
                       help='–ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: project_content.txt)')
    
    args = parser.parse_args()
    
    try:
        scanner = ProjectScanner(root_dir=args.dir, output_file=args.output)
        scanner.scan_project()
    except KeyboardInterrupt:
        print("\n\n–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
        sys.exit(1)
    except Exception as e:
        print(f"\n–û—à–∏–±–∫–∞: {e}")
        print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:")
        print("1. –£–∫–∞–∑–∞–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        print("2. –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤")
        print("3. –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª")
        sys.exit(1)


if __name__ == "__main__":
    main()


================================================================================
–§–ê–ô–õ: config.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /home/slay/test_aio3/config.py
–†–ê–ó–ú–ï–†: 1209 –±–∞–π—Ç
================================================================================

from dataclasses import dataclass
from environs import Env


@dataclass
class DatabaseConfig:
    name: str         # –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    host: str         # URL-–∞–¥—Ä–µ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    user: str         # Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    password: str     # –ü–∞—Ä–æ–ª—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    port: int


    def get_database_url():
        return f'postgresql+asyncpg://{user}:{password}@{host}:{port}/{name}'
    

@dataclass
class TgBot:
    token: str            # –¢–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç—É
#    admin_ids: list[int]  # –°–ø–∏—Å–æ–∫ id –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –±–æ—Ç–∞


@dataclass
class Config:
    bot: TgBot
    db: DatabaseConfig


def load_config(path: str | None = None) -> Config:

    env: Env = Env()
    env.read_env(path)

    return Config(
        bot=TgBot(
            token=env('TOKEN'),
#            admin_ids=list(map(int, env.list('ADMIN_IDS')))
        ),
        db=DatabaseConfig(
            name=env('DB_NAME'),
            host=env('DB_HOST'),
            user=env('DB_USER'),
            password=env('DB_PASSWORD'),
            port=env('DB_PORT')
        )
    )



================================================================================
–§–ê–ô–õ: handlers.py
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /home/slay/test_aio3/handlers.py
–†–ê–ó–ú–ï–†: 1667 –±–∞–π—Ç
================================================================================

import asyncio
import os
from aiogram.filters import CommandStart, Command
from aiogram.types import Message, ReplyKeyboardRemove
from concurrent.futures import ThreadPoolExecutor
from fast_whisp_test import processor
from aiogram import F, Router



pool = ThreadPoolExecutor(max_workers=2) 

router = Router()


@router.message(CommandStart())
async def cmd_start(message: Message):
    await message.answer(
        '–ü—Ä–∏–≤–µ—Ç! –Ø —É–º–µ—é —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å —Ä–µ—á—å –≤ –≥—Å! –ü—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—Ç—å –Ω–∞ –Ω—É–∂–Ω–æ–µ —Ç–µ–±–µ –≥—Å –∫–æ–º–∞–Ω–¥–æ–π /run!',
        reply_markup=ReplyKeyboardRemove()
    )


@router.message(Command('run'))
async def transribe(message: Message):

    if not message.reply_to_message:
        await message.answer('–Ω—É–∂–Ω–æ –∏–º–µ–Ω–Ω–æ –û–¢–í–ï–¢–ò–¢–¨ –Ω–∞ –≥—Å –∫–æ–º–∞–Ω–¥–æ–π /run —á—Ç–æ–±—ã —è –ø–æ–Ω—è–ª, –∫–∞–∫–æ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –≥—Å —Ç–µ–±–µ –Ω—É–∂–Ω–æ')
        return

    voice = message.reply_to_message.voice
    
    if not voice:
        await message.answer('–Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –∏–º–µ–Ω–Ω–æ –Ω–∞ –ì–°')
        return

    file_id = voice.file_id
    file = await message.bot.get_file(file_id)

    await message.bot.download_file(
        file.file_path,
        destination=f'voices/{file_id}.ogg'
    )

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å "–ø–µ—á–∞—Ç–∞–µ—Ç..."
    await message.bot.send_chat_action(
        chat_id=message.chat.id,
        action="typing"
    )

    loop = asyncio.get_running_loop()
    result = await loop.run_in_executor(pool, processor.transcribe, file_id)

    await message.reply_to_message.reply("".join(result))

#    os.remove(f'voices/{file_id}')






================================================================================
–§–ê–ô–õ: .gitignore
–ü–û–õ–ù–´–ô –ü–£–¢–¨: /home/slay/test_aio3/.gitignore
–†–ê–ó–ú–ï–†: 45 –±–∞–π—Ç
================================================================================

.venv
.env
__pycache__/
voices/
flows_test.py

